<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kalkulator BMR & TDEE Akurat</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: Arial; background:#f0f0f0; padding:20px; }
  .container { background:white; padding:20px; border-radius:10px; max-width:700px; margin:auto; }
  label { font-weight:bold; }
  input, select { width:100%; padding:8px; margin-top:5px; margin-bottom:15px; }
  button { padding:10px 20px; background:#007bff; color:white; border:none; border-radius:5px; cursor:pointer; }
  button:hover { background:#0056c7; }
</style>
</head>
<body>

<div class="container">
<h2>Kalkulator BMR, TDEE, dan Prediksi Berat (Akurat)</h2>

<label>Berat (kg)</label>
<input id="w" type="number">

<label>Tinggi (cm)</label>
<input id="h" type="number">

<label>Usia</label>
<input id="a" type="number">

<label>Jenis Kelamin</label>
<select id="gender">
  <option value="male">Laki-laki</option>
  <option value="female">Perempuan</option>
</select>

<label>Aktivitas</label>
<select id="act">
  <option value="tidak_aktif">Tidak aktif</option>
  <option value="ringan">Ringan</option>
  <option value="sedang">Sedang</option>
  <option value="berat">Berat</option>
  <option value="sangat_berat">Sangat berat</option>
</select>

<label>Asupan Kalori (kcal/hari)</label>
<input id="intake" type="number">

<label>Berat Awal (kg)</label>
<input id="initialW" type="number">

<button onclick="triggerCalc()">Hitung</button>

<h3>Hasil</h3>
<p id="bmrOut"></p>
<p id="tdeeOut"></p>
<p id="diffOut"></p>

<canvas id="kaloriChart" height="120"></canvas>
<br>
<canvas id="beratChart" height="120"></canvas>
</div>

<script>
// =========================
// BMR (Mifflinâ€“St Jeor)
// =========================
function calcBMR(w, h, a, gender) {
    if (gender === "male") {
        return (10 * w) + (6.25 * h) - (5 * a) + 5;
    } else {
        return (10 * w) + (6.25 * h) - (5 * a) - 161;
    }
}

// =========================
// Faktor Aktivitas
// =========================
function faktorAktivitas(level) {
    switch (level) {
        case "tidak_aktif": return 1.2;
        case "ringan": return 1.375;
        case "sedang": return 1.55;
        case "berat": return 1.725;
        case "sangat_berat": return 1.9;
    }
}

// =========================
// TDEE
// =========================
function calcTDEE(bmr, act) {
    return bmr * faktorAktivitas(act);
}

// =========================
// Grafik Kalori 7 Hari TANPA fluktuasi palsu
// =========================
function genKalori7days(tdee) {
    return Array(7).fill(Math.round(tdee));
}

// =========================
// Grafik Prediksi Berat 30 Hari
// =========================
function genWeight30days(initialWeight, dailyCalDiff) {
    const arr = [];
    const kgPerCal = 1 / 7700; // 7700 kalori = 1 kg
    let w = initialWeight;

    for (let i = 0; i < 30; i++) {
        w += dailyCalDiff * kgPerCal;
        arr.push(parseFloat(w.toFixed(2)));
    }
    return arr;
}

// =========================
// CHART
// =========================
let kaloriChart, beratChart;

function updateCharts(kal7, w30) {
    const ctx1 = document.getElementById("kaloriChart").getContext("2d");
    const ctx2 = document.getElementById("beratChart").getContext("2d");

    if (kaloriChart) kaloriChart.destroy();
    if (beratChart) beratChart.destroy();

    kaloriChart = new Chart(ctx1, {
        type: "line",
        data: {
            labels: ["1","2","3","4","5","6","7"],
            datasets: [{
                label: "Kalori Terbakar (TDEE)",
                data: kal7,
                borderColor: "blue",
                borderWidth: 2,
                fill: false
            }]
        }
    });

    beratChart = new Chart(ctx2, {
        type: "line",
        data: {
            labels: Array.from({length:30}, (_,i)=>i+1),
            datasets: [{
                label: "Prediksi Berat 30 Hari",
                data: w30,
                borderColor: "green",
                borderWidth: 2,
                fill: false
            }]
        }
    });
}

// =========================
// TRIGGER
// =========================
function triggerCalc() {
    const w = Number(document.getElementById("w").value);
    const h = Number(document.getElementById("h").value);
    const a = Number(document.getElementById("a").value);
    const gender = document.getElementById("gender").value;
    const act = document.getElementById("act").value;
    const intake = Number(document.getElementById("intake").value);
    const initialW = Number(document.getElementById("initialW").value);

    const bmr = calcBMR(w,h,a,gender);
    const tdee = calcTDEE(bmr, act);

    // Perhitungan selisih yang benar:
    const diff = intake - tdee;

    document.getElementById("bmrOut").innerHTML = `BMR: ${bmr.toFixed(2)} kcal`;
    document.getElementById("tdeeOut").innerHTML = `TDEE: ${tdee.toFixed(2)} kcal`;
    document.getElementById("diffOut").innerHTML = `Selisih Kalori (Intake - TDEE): ${diff.toFixed(2)} kcal/hari`;

    const kal7 = genKalori7days(tdee);
    const w30 = genWeight30days(initialW, diff);

    updateCharts(kal7, w30);
}
</script>

</body>
</html>
